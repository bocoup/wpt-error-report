<!doctype html>
<html>
<head>
  <link rel="stylesheet" type="text/css" href="styles.css">
  <link rel="import" href="results.html">
</head>
<body>
<header>
  <section>
    <h1>wpt-error-report</h1>
    <p>
      The following results represent a consolidated report of <a href="http://github.com/w3c/web-platform-tests">web-platform-tests</a> (WPT) test files that fail to run to completion across all target browsers. These incomplete test runs cause inconsistent test completion counts between browsers when running the WPT test suite.
    </p>

    <h3>Preliminary Analysis</h3>
    <p>
      The most likely reason for a test file failing in this way, with inconsistent test counts, is the presence of a JavaScript error. This can manifest in myriad ways. Here are some helpful starting points for determining the cause of an incomplete test run in one of the test files:
    </p>
    <ul>
      <li>Is there an assumption about an API method that's not yet fully implemented?</li>
      <li>Is there an assumption about an API surface property that's not yet fully implemented?</li>
      <li>Is it an async test that does not resolve before the test harness times out?</li>
    </ul>

    <h3>How can you help</h3>
    <ol>
      <li>Find the offending test file you'd like to tackle in the list below.</li>
      <li>Fork the <a href="https://github.com/w3c/web-platform-tests">w3c/web-platform-tests</a> repository.</li>
      <li>Follow the steps at <a href="https://github.com/w3c/web-platform-tests#setting-up-the-repo">w3c/web-platform-tests#setting-up-the-repo</a>.</li>
      <li>Open your selected file in a browser that it is shown to be failing in the report below.</li>
      <li>Figure out why the tests in the file do not run to completion in the relevant browser.</li>
      <li>Fix that problem, commit your work in a branch on your fork of WPT, and open <a href="https://help.github.com/articles/about-pull-requests/">a pull request</a>.</li>
      <li>
        Here are some friendly people who you can tag as a reviewer on your pull request to get some extra support:
        <ul>
          <li><a href="http://github.com/rwaldron">@rwaldron</a></li>
          <li><a href="http://github.com/bobholt">@bobholt</a></li>
          <li><a href="http://github.com/jugglinmike">@jugglinmike</a></li>
          <li><a href="http://github.com/boazsender">@boazsender</a></li>
          <li><a href="http://github.com/leobalter">@leobalter</a></li>
          <li>Interested in joining this list? <a href="https://github.com/bocoup/wpt-error-report/issues/2">Sign up here</a></li>
        </ul>
      </li>
      <li>
        Tweet at us at <a href="http://twitter.com/bocoup">@bocoup</a>, to let us know about your contribution so we can high five.
      </li>
    </ol>
  </section>
</header>
<nav>
  <section>
    <button class="toggle">Toggle All Results</button>
    <button class="sort" data-mode="by-percent">Sort Results by Percent Not Run</button>
  </section>
</nav>
<main>

</main>
<footer>
  <section>
    <p>
      These results were collected from a run of <a href="https://github.com/w3c/web-platform-tests/tree/e511e5e8af">WPT at <code>e511e5e8af</code></a>, which was generated from the <a href="http://wpt.fyi">wpt.fyi</a> dashboard data sources.

      Source results data for all WPT tests are available here:
      <li><a href="https://storage.googleapis.com/wptd/e511e5e8af/chrome-62.0-linux-summary.json.gz">Chrome on Linux WPT results JSON</a></li>
      <li><a href="https://storage.googleapis.com/wptd/e511e5e8af/edge-15-windows-10-sauce-summary.json.gz">Edge on Windows WPT results JSON</a></li>
      <li><a href="https://storage.googleapis.com/wptd/e511e5e8af/firefox-57.0-linux-summary.json.gz">Firefox on Linux WPT results JSON</a></li>
      <li><a href="https://storage.googleapis.com/wptd/e511e5e8af/safari-10-macos-10.12-sauce-summary.json.gz">Safari on Linux WPT results JSON</a></li>
    </p>
    <p>
      The consolidated "unrun test cases" source results data is available in this project's repo:
      <li><a href="https://raw.githubusercontent.com/bocoup/wpt-error-report/master/consolidated.json">consolidated.json</a></li>
    </p>
    <p>
      See <a href="https://github.com/GoogleChrome/wptdashboard/issues/98">GoogleChrome/wptdashboard/issues/98</a> for more discussion.
    </p>
  </section>
</footer>
<script>
document.addEventListener("DOMContentLoaded", () => {

  // Add results to DOM
  let results = document.querySelector('link[rel="import"]');

  if (!results.import) {
    var xhr = new XMLHttpRequest();
    xhr.onload = function() {
      injectResults(this.responseXML);
    };
    xhr.open("GET", "results.html");
    xhr.responseType = "document";
    xhr.send();
  } else {
    setTimeout(function() {
      injectResults(results.import);
    }, 0);
  }

  function injectResults(results) {
    let nodes = results.querySelector('body').children;
    let main = document.querySelector('main');
    resultsToDOM(nodes);

    //Bind toggle and sorts
    let isOpen = false;
    document.querySelector('body').addEventListener("click", (event) => {
      if (event.target.tagName !== "BUTTON") {
        return
      }

      if (event.target.className === "toggle") {
        isOpen = !isOpen;
        [...toIterable(document.querySelectorAll("details"))].forEach(detail => {
          detail.open = isOpen;
        });
        return;
      }

      if (event.target.dataset.mode === "by-percent") {
        event.target.innerText = "Sort Alphabetically"
        event.target.dataset.mode = "by-alpha"
        resultsToDOM(sortables.sort(sortByPercent));
        return;
      }

      if (event.target.dataset.mode === "by-alpha") {
        event.target.innerText = "Sort Results by Percent Not Run"
        event.target.dataset.mode = "by-percent";
        resultsToDOM(sortables.sort(sortByAlpha));
        return;
      }

    });

    // Setup results for sorting
    let sortables = [...toIterable(main.children)];

    function sortByPercent(a, b) {
      let aPercent = parseInt(a.firstElementChild.dataset.percent);
      let bPercent = parseInt(b.firstElementChild.dataset.percent);

      return aPercent === bPercent ? 0 : (aPercent > bPercent ? -1 : 1);
    };

    function sortByAlpha(a, b) {
      let aText = a.firstElementChild.innerText.substr(0, 10);
      let bText = b.firstElementChild.innerText.substr(0, 10);

      return aText === bText ? 0 : (aText > bText ? 1 : -1);
    };

    function resultsToDOM(resultsArr) {
      main.innerHTML = '';
      [...toIterable(resultsArr)].forEach(function(elem) {
        main.appendChild(elem);
      });
    }
  }

  function toIterable(iterable) {
    if (!iterable[Symbol.iterator]) {
      iterable[Symbol.iterator] = Array.prototype[Symbol.iterator];
    }
    return iterable;
  }
}, false);
</script>
</body>
</html>
